# üóÑÔ∏è Cheat Sheet - SQL

> üìù Um guia completo sobre SQL (Structured Query Language) - A linguagem padr√£o para manipula√ß√£o de bancos de dados relacionais

## üìë √çndice
1. [Conceitos B√°sicos](#conceitos-b√°sicos)
2. [Sintaxe Fundamental](#sintaxe-fundamental)
3. [Estruturas Principais](#estruturas-principais)
4. [Recursos Avan√ßados](#recursos-avan√ßados)
5. [Comandos de Visualiza√ß√£o](#comandos-de-visualiza√ß√£o)
6. [Melhores Pr√°ticas](#melhores-pr√°ticas)
7. [Exemplos Pr√°ticos](#exemplos-pr√°ticos)
8. [Links √öteis](#links-√∫teis)

## üìò Conceitos B√°sicos

### üîë Tipos de Comandos SQL
| Tipo | Descri√ß√£o | Uso | Comandos Principais |
|------|-----------|-----|-------------------|
| `DDL` | Data Definition Language | Defini√ß√£o da estrutura | `CREATE`, `ALTER`, `DROP`, `TRUNCATE`, `RENAME` |
| `DML` | Data Manipulation Language | Manipula√ß√£o de dados | `INSERT`, `UPDATE`, `DELETE`, `MERGE` |
| `DQL` | Data Query Language | Consulta de dados | `SELECT` |
| `DCL` | Data Control Language | Controle de acesso | `GRANT`, `REVOKE` |
| `TCL` | Transaction Control Language | Controle de transa√ß√µes | `COMMIT`, `ROLLBACK`, `SAVEPOINT` |

### üìù Comandos DDL (Data Definition Language)
| Comando | Descri√ß√£o | Exemplo | Resultado |
|---------|-----------|---------|-----------|
| `CREATE` | Cria objetos | `CREATE TABLE usuarios (id INT)` | Nova tabela criada |
| `ALTER` | Modifica objetos | `ALTER TABLE usuarios ADD email VARCHAR(100)` | Coluna adicionada |
| `DROP` | Remove objetos | `DROP TABLE usuarios` | Tabela removida |
| `TRUNCATE` | Limpa dados | `TRUNCATE TABLE logs` | Dados removidos |
| `RENAME` | Renomeia objetos | `RENAME TABLE users TO usuarios` | Tabela renomeada |
| `COMMENT` | Adiciona coment√°rios | `COMMENT ON TABLE usuarios IS 'Tabela de usu√°rios'` | Coment√°rio adicionado |

### üìù Comandos DML (Data Manipulation Language)
| Comando | Descri√ß√£o | Exemplo | Resultado |
|---------|-----------|---------|-----------|
| `INSERT` | Insere dados | `INSERT INTO usuarios (nome) VALUES ('Jo√£o')` | Registro inserido |
| `UPDATE` | Atualiza dados | `UPDATE usuarios SET status = 'ativo'` | Registros atualizados |
| `DELETE` | Remove dados | `DELETE FROM usuarios WHERE inativo = true` | Registros removidos |
| `MERGE` | Mescla dados | `MERGE INTO target USING source ON (id)` | Dados mesclados |
| `CALL` | Chama procedure | `CALL calcular_total(1, @resultado)` | Procedure executada |
| `EXPLAIN` | Plano de execu√ß√£o | `EXPLAIN SELECT * FROM usuarios` | Plano exibido |

### üìù Comandos DQL (Data Query Language)
| Comando | Descri√ß√£o | Exemplo | Resultado |
|---------|-----------|---------|-----------|
| `SELECT` | Consulta b√°sica | `SELECT * FROM usuarios` | Retorna registros |
| `FROM` | Origem dos dados | `FROM usuarios u` | Define tabela fonte |
| `WHERE` | Filtra registros | `WHERE idade >= 18` | Filtra resultados |
| `GROUP BY` | Agrupa registros | `GROUP BY departamento` | Agrupa dados |
| `HAVING` | Filtra grupos | `HAVING COUNT(*) > 5` | Filtra grupos |
| `ORDER BY` | Ordena resultados | `ORDER BY nome ASC` | Ordena dados |
| `DISTINCT` | Remove duplicados | `SELECT DISTINCT cidade FROM usuarios` | Valores √∫nicos |

### üìù Comandos DCL (Data Control Language)
| Comando | Descri√ß√£o | Exemplo | Resultado |
|---------|-----------|---------|-----------|
| `GRANT` | Concede permiss√µes | `GRANT SELECT ON usuarios TO user1` | Permiss√£o concedida |
| `REVOKE` | Remove permiss√µes | `REVOKE INSERT ON produtos FROM user1` | Permiss√£o removida |
| `DENY` | Nega permiss√µes | `DENY DELETE ON logs TO user1` | Permiss√£o negada |
| `CREATE USER` | Cria usu√°rio | `CREATE USER user1 WITH PASSWORD '123'` | Usu√°rio criado |
| `ALTER USER` | Modifica usu√°rio | `ALTER USER user1 WITH PASSWORD '456'` | Usu√°rio modificado |
| `DROP USER` | Remove usu√°rio | `DROP USER user1` | Usu√°rio removido |

### üìù Comandos TCL (Transaction Control Language)
| Comando | Descri√ß√£o | Exemplo | Resultado |
|---------|-----------|---------|-----------|
| `BEGIN` | Inicia transa√ß√£o | `BEGIN TRANSACTION` | Transa√ß√£o iniciada |
| `COMMIT` | Confirma altera√ß√µes | `COMMIT` | Altera√ß√µes salvas |
| `ROLLBACK` | Desfaz altera√ß√µes | `ROLLBACK` | Altera√ß√µes desfeitas |
| `SAVEPOINT` | Ponto de restaura√ß√£o | `SAVEPOINT ponto1` | Savepoint criado |
| `SET TRANSACTION` | Define transa√ß√£o | `SET TRANSACTION ISOLATION LEVEL READ COMMITTED` | Isolamento definido |

## üîß Sintaxe Fundamental

### üéØ Opera√ß√µes B√°sicas (CRUD)
| Opera√ß√£o | Comando | Exemplo | Resultado |
|----------|---------|---------|-----------|
| `CREATE` | INSERT | `INSERT INTO usuarios (nome) VALUES ('Jo√£o')` | Insere novo registro |
| `READ` | SELECT | `SELECT * FROM usuarios WHERE id = 1` | L√™ dados existentes |
| `UPDATE` | UPDATE | `UPDATE usuarios SET nome = 'Jo√£o Silva' WHERE id = 1` | Atualiza registro |
| `DELETE` | DELETE | `DELETE FROM usuarios WHERE id = 1` | Remove registro |

### üìù Exemplo Pr√°tico: Consulta B√°sica
```sql
SELECT 
    nome,           # -----------------------> Campo a ser retornado
    idade          # -----------------------> Outro campo
FROM 
    usuarios       # -----------------------> Tabela fonte
WHERE 
    idade > 18     # -----------------------> Condi√ß√£o de filtro
ORDER BY 
    nome ASC;      # -----------------------> Ordena√ß√£o
```

## üîÑ Estruturas Principais

### üîó JOINs e Relacionamentos
| Tipo | Descri√ß√£o | Exemplo | Resultado |
|------|-----------|---------|-----------|
| `INNER JOIN` | Intersec√ß√£o | `SELECT * FROM A INNER JOIN B ON A.id = B.id` | Registros comuns |
| `LEFT JOIN` | Todos de A | `SELECT * FROM A LEFT JOIN B ON A.id = B.id` | Todos de A + comuns |
| `RIGHT JOIN` | Todos de B | `SELECT * FROM A RIGHT JOIN B ON A.id = B.id` | Todos de B + comuns |
| `FULL JOIN` | Uni√£o | `SELECT * FROM A FULL JOIN B ON A.id = B.id` | Todos os registros |

### üìù Exemplo Pr√°tico: JOIN M√∫ltiplo
```sql
SELECT 
    u.nome,         # -----------------------> Campo da tabela usuarios
    p.produto       # -----------------------> Campo da tabela pedidos
FROM 
    usuarios u      # -----------------------> Alias para usuarios
    INNER JOIN 
    pedidos p      # -----------------------> Join com tabela pedidos
    ON u.id = p.usuario_id;
```

## üöÄ Recursos Avan√ßados

### üìä Fun√ß√µes de Agrega√ß√£o
| Fun√ß√£o | Descri√ß√£o | Exemplo | Resultado |
|--------|-----------|---------|-----------|
| `COUNT()` | Conta registros | `SELECT COUNT(*) FROM users` | Total de registros |
| `SUM()` | Soma valores | `SELECT SUM(valor) FROM vendas` | Soma total |
| `AVG()` | M√©dia | `SELECT AVG(idade) FROM usuarios` | M√©dia de idade |
| `MAX()` | Valor m√°ximo | `SELECT MAX(preco) FROM produtos` | Maior pre√ßo |
| `MIN()` | Valor m√≠nimo | `SELECT MIN(data) FROM eventos` | Data mais antiga |

### üìù Exemplo Pr√°tico: Subquery
```sql
SELECT 
    nome,
    (SELECT COUNT(*) 
     FROM pedidos 
     WHERE pedidos.usuario_id = usuarios.id
    ) as total_pedidos    # -----------------------> Subquery correlacionada
FROM usuarios;
```

## üîí Constraints (Restri√ß√µes)
| Constraint | Descri√ß√£o | Exemplo | Resultado |
|------------|-----------|---------|-----------|
| `PRIMARY KEY` | Identifica unicamente cada registro | `id INT PRIMARY KEY` | Chave prim√°ria definida |
| `FOREIGN KEY` | Estabelece relacionamento entre tabelas | `FOREIGN KEY (dept_id) REFERENCES departamentos(id)` | Chave estrangeira definida |
| `UNIQUE` | Garante valores √∫nicos | `email VARCHAR(100) UNIQUE` | N√£o permite duplicatas |
| `NOT NULL` | N√£o permite valores nulos | `nome VARCHAR(100) NOT NULL` | Valor obrigat√≥rio |
| `CHECK` | Valida valor conforme condi√ß√£o | `CHECK (idade >= 18)` | Valida dados na inser√ß√£o |
| `DEFAULT` | Define valor padr√£o | `status VARCHAR(20) DEFAULT 'ativo'` | Valor padr√£o definido |

### üìù Exemplo Pr√°tico: Uso de Constraints
```sql
-- Criar banco de dados para sistema escolar
CREATE DATABASE escola;
USE escola;

-- Tabela de cursos com v√°rias constraints
CREATE TABLE cursos (
    id INT PRIMARY KEY AUTO_INCREMENT,  # -----------------------> Chave prim√°ria
    codigo VARCHAR(10) UNIQUE NOT NULL, # -----------------------> √önico e obrigat√≥rio
    nome VARCHAR(100) NOT NULL,         # -----------------------> Obrigat√≥rio
    carga_horaria INT NOT NULL,         # -----------------------> Obrigat√≥rio
    preco DECIMAL(10,2) NOT NULL,       # -----------------------> Obrigat√≥rio
    nivel VARCHAR(20) DEFAULT 'B√°sico', # -----------------------> Valor padr√£o
    status VARCHAR(20) DEFAULT 'Ativo', # -----------------------> Valor padr√£o
    data_criacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP, # ---------> Timestamp autom√°tico
    CHECK (carga_horaria >= 20),        # -----------------------> Valida√ß√£o de valor m√≠nimo
    CHECK (preco >= 0),                 # -----------------------> Valida√ß√£o de valor n√£o negativo
    CHECK (nivel IN ('B√°sico', 'Intermedi√°rio', 'Avan√ßado')), # -> Valida√ß√£o de valores permitidos
    CONSTRAINT uk_codigo UNIQUE (codigo) # -----------------------> Constraint nomeada
);

-- Tabela de professores com constraints
CREATE TABLE professores (
    id INT PRIMARY KEY AUTO_INCREMENT,
    matricula VARCHAR(10) UNIQUE NOT NULL,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    data_contratacao DATE DEFAULT CURRENT_DATE,
    salario DECIMAL(10,2) NOT NULL,
    CHECK (salario > 0)
);

-- Tabela de turmas com m√∫ltiplas foreign keys e checks
CREATE TABLE turmas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    codigo VARCHAR(10) UNIQUE NOT NULL,
    curso_id INT NOT NULL,
    professor_id INT NOT NULL,
    data_inicio DATE NOT NULL,
    data_fim DATE NOT NULL,
    vagas INT NOT NULL,
    vagas_ocupadas INT DEFAULT 0,
    
    -- Foreign Keys
    CONSTRAINT fk_curso FOREIGN KEY (curso_id)
        REFERENCES cursos(id)
        ON DELETE RESTRICT          # -----------------------> Impede dele√ß√£o se houver refer√™ncias
        ON UPDATE CASCADE,          # -----------------------> Atualiza refer√™ncias automaticamente
    
    CONSTRAINT fk_professor FOREIGN KEY (professor_id)
        REFERENCES professores(id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    
    -- Checks
    CONSTRAINT chk_datas CHECK (data_fim > data_inicio), # ----> Valida per√≠odo
    CONSTRAINT chk_vagas CHECK (vagas >= vagas_ocupadas), # ---> Valida quantidade de vagas
    CONSTRAINT chk_vagas_min CHECK (vagas >= 5),         # ----> M√≠nimo de vagas
    CONSTRAINT chk_vagas_max CHECK (vagas <= 50)         # ----> M√°ximo de vagas
);

-- Adicionar constraint ap√≥s cria√ß√£o da tabela
ALTER TABLE turmas
    ADD CONSTRAINT chk_codigo_formato 
    CHECK (codigo REGEXP '^[A-Z]{2}[0-9]{4}$'); # ---------> Formato espec√≠fico para c√≥digo

-- Remover constraint
ALTER TABLE turmas
    DROP CONSTRAINT chk_codigo_formato;

-- Exemplo de inser√ß√£o respeitando constraints
INSERT INTO cursos (codigo, nome, carga_horaria, preco, nivel) 
VALUES ('SQL001', 'SQL B√°sico', 40, 199.99, 'B√°sico');

INSERT INTO professores (matricula, nome, email, salario)
VALUES ('PROF001', 'Ana Silva', 'ana@escola.com', 5000.00);

INSERT INTO turmas (codigo, curso_id, professor_id, data_inicio, data_fim, vagas)
VALUES ('TB202401', 1, 1, '2024-02-01', '2024-03-30', 30);
```

> üí° **Dica:** Use constraints nomeadas (CONSTRAINT nome_constraint) para facilitar sua manuten√ß√£o posterior

## üìã Comandos de Visualiza√ß√£o
| Comando | Descri√ß√£o | Exemplo | Resultado |
|---------|-----------|---------|-----------|
| `SHOW DATABASES` | Lista todos os bancos | `SHOW DATABASES` | Lista de bancos dispon√≠veis |
| `SHOW TABLES` | Lista tabelas do banco atual | `SHOW TABLES` | Lista de tabelas |
| `SHOW COLUMNS` | Lista colunas da tabela | `SHOW COLUMNS FROM usuarios` | Estrutura da tabela |
| `DESC` ou `DESCRIBE` | Descreve estrutura da tabela | `DESC usuarios` | Detalhes das colunas |
| `SHOW CREATE TABLE` | Mostra comando de cria√ß√£o | `SHOW CREATE TABLE usuarios` | DDL da tabela |
| `SHOW INDEX` | Mostra √≠ndices da tabela | `SHOW INDEX FROM usuarios` | Lista de √≠ndices |
| `SHOW PROCESSLIST` | Lista processos ativos | `SHOW PROCESSLIST` | Processos em execu√ß√£o |
| `SHOW VARIABLES` | Lista vari√°veis do sistema | `SHOW VARIABLES LIKE '%timeout%'` | Configura√ß√µes do sistema |
| `SHOW STATUS` | Mostra status do servidor | `SHOW STATUS` | Estado do servidor |
| `SHOW GRANTS` | Mostra permiss√µes | `SHOW GRANTS FOR 'user'@'localhost'` | Permiss√µes do usu√°rio |

### üìù Exemplo Pr√°tico: An√°lise de Estrutura
```sql
-- Listar todos os bancos de dados
SHOW DATABASES;                 # -----------------------> Lista bancos dispon√≠veis

-- Selecionar banco de dados
USE meu_banco;                  # -----------------------> Seleciona banco atual

-- Listar todas as tabelas
SHOW TABLES;                    # -----------------------> Lista tabelas do banco

-- Ver estrutura detalhada
DESC usuarios;                  # -----------------------> Mostra estrutura da tabela
/* Resultado exemplo:
+----------+--------------+------+-----+---------+----------------+
| Field    | Type         | Null | Key | Default | Extra          |
+----------+--------------+------+-----+---------+----------------+
| id       | int(11)      | NO   | PRI | NULL    | auto_increment |
| nome     | varchar(100) | NO   |     | NULL    |                |
| email    | varchar(100) | YES  | UNI | NULL    |                |
+----------+--------------+------+-----+---------+----------------+
*/

-- Ver informa√ß√µes de √≠ndices
SHOW INDEX FROM usuarios;       # -----------------------> Lista √≠ndices da tabela

-- Ver DDL da tabela
SHOW CREATE TABLE usuarios\G    # -----------------------> Mostra comando de cria√ß√£o
```

> üí° **Dica:** Use `\G` ao inv√©s de `;` para visualizar resultados em formato vertical, especialmente √∫til para resultados longos

## ‚ö° Melhores Pr√°ticas
| Pr√°tica | Descri√ß√£o | Exemplo | Benef√≠cio |
|---------|-----------|---------|-----------|
| `√çndices` | Criar √≠ndices | `CREATE INDEX idx_nome ON usuarios(nome)` | Acelera buscas |
| `EXPLAIN` | Analisar query | `EXPLAIN SELECT * FROM usuarios` | Identifica problemas |
| `Limit` | Limitar resultados | `SELECT * FROM logs LIMIT 1000` | Melhora performance |

> üí° **Dica:** Use EXPLAIN antes de executar queries complexas em produ√ß√£o

## üìù Exemplos Pr√°ticos

### Cria√ß√£o Completa de Banco de Dados
```sql
-- Criar novo banco de dados
CREATE DATABASE empresa         # -----------------------> Cria banco de dados
    DEFAULT CHARACTER SET utf8  # -----------------------> Define charset
    DEFAULT COLLATE utf8_general_ci; # -----------------> Define collation

-- Selecionar o banco de dados
USE empresa;                    # -----------------------> Seleciona o banco

-- Criar tabela de departamentos
CREATE TABLE departamentos (    # -----------------------> Cria tabela base
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(50) NOT NULL,
    localizacao VARCHAR(100)
);

-- Criar tabela de funcion√°rios com foreign key
CREATE TABLE funcionarios (     # -----------------------> Cria tabela com relacionamento
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    salario DECIMAL(10,2),
    data_contratacao DATE DEFAULT CURRENT_DATE,
    departamento_id INT,
    FOREIGN KEY (departamento_id)      # -----------------------> Define chave estrangeira
        REFERENCES departamentos(id)    # -----------------------> Referencia tabela pai
        ON DELETE SET NULL             # -----------------------> A√ß√£o quando registro pai √© deletado
        ON UPDATE CASCADE              # -----------------------> A√ß√£o quando registro pai √© atualizado
);

-- Criar √≠ndices para otimiza√ß√£o
CREATE INDEX idx_func_nome ON funcionarios(nome);  # ----> √çndice para busca por nome
CREATE INDEX idx_func_dept ON funcionarios(departamento_id); # -> √çndice para join

-- Inserir dados iniciais
INSERT INTO departamentos (nome, localizacao) VALUES 
    ('TI', 'Sala 101'),
    ('RH', 'Sala 102'),
    ('Vendas', 'Sala 103');

INSERT INTO funcionarios 
    (nome, email, salario, departamento_id) 
VALUES 
    ('Jo√£o Silva', 'joao@empresa.com', 5000.00, 1),
    ('Maria Santos', 'maria@empresa.com', 6000.00, 1),
    ('Pedro Costa', 'pedro@empresa.com', 4500.00, 2);

-- Criar view para relat√≥rio
CREATE VIEW vw_funcionarios_dept AS  # -----------------------> Cria view
SELECT 
    f.nome as funcionario,
    f.salario,
    d.nome as departamento
FROM 
    funcionarios f
    INNER JOIN departamentos d ON d.id = f.departamento_id;
```

> üí° **Dica:** Sempre planeje a estrutura do banco antes de criar as tabelas, considerando relacionamentos e √≠ndices necess√°rios

### Comandos por SGBD
{{ ... se√ß√£o de comandos por SGBD existente ... }}

## üìö Links √öteis
- [üìñ Documenta√ß√£o MySQL](https://dev.mysql.com/doc/)
- [üìñ Documenta√ß√£o PostgreSQL](https://www.postgresql.org/docs/)
- [üìù W3Schools SQL Tutorial](https://www.w3schools.com/sql/)
- [üéì SQL Zoo](https://sqlzoo.net/)
- [üìò Mode SQL Tutorial](https://mode.com/sql-tutorial/)
- [üîç PostgreSQL Exercises](https://pgexercises.com/)
- [üìä SQLBolt](https://sqlbolt.com/)
- [üéØ HackerRank SQL](https://www.hackerrank.com/domains/sql)

<style>
:root {
    --bg-primary: #1E1E1E;
    --bg-secondary: #252526;
    --bg-tertiary: #2D2D2D;
    --text-primary: #D4D4D4;
    --text-accent: #569CD6;
    --keyword: #C586C0;
    --string: #CE9178;
    --comment: #6A9955;
    --operator: #D4D4D4;
    --border: #404040;
}

body {
    background-color: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Consolas', monospace;
    line-height: 1.6;
    margin: 20px;
    max-width: 1920px;
}

.container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
    gap: 20px;
    margin: 0 auto;
}

.section {
    background: var(--bg-secondary);
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
    background-color: var(--bg-tertiary);
    border-radius: 4px;
}

th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--border);
}

td:nth-child(3) {
    font-family: 'Consolas', monospace;
    color: var(--string);
}

td:nth-child(4) {
    color: var(--comment);
    font-style: italic;
}

code {
    color: var(--string);
    background-color: var(--bg-tertiary);
    padding: 2px 4px;
    border-radius: 3px;
}

h2 {
    color: var(--text-accent);
    border-bottom: 1px solid var(--text-accent);
    padding-bottom: 5px;
}

h3 {
    color: var(--keyword);
}

.example {
    background-color: var(--bg-tertiary);
    padding: 8px;
    border-radius: 4px;
    margin-top: 4px;
    font-size: 0.9em;
}

```
